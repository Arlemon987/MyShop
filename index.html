<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shop Manager</title>
<meta name="theme-color" content="#007bff">

<style>
body{font-family:Arial;margin:0;padding:15px;background:#f2f2f2}
h1{text-align:center}
input,button,textarea{padding:10px;margin:5px 0;width:100%;box-sizing:border-box;font-size:16px}
button{background:#007bff;color:white;border:none;border-radius:6px}
button:active{opacity:.8}
.card{background:white;padding:15px;margin-top:15px;border-radius:10px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:left}
.suggestion-item{padding:8px;cursor:pointer}
.suggestion-item:hover{background:#eee}

/* PRINT ONLY RECEIPT */
@media print{
body *{visibility:hidden}
#receiptArea, #receiptArea *{visibility:visible}
#receiptArea{position:absolute;left:0;top:0;width:100%}
}
</style>
</head>
<body>

<h1>Shop Manager</h1>

<div class="card">
<h3>Add / Restock Product</h3>
<input id="pname" placeholder="Product Name">
<input id="pcode" placeholder="Product Code">
<input id="pprice" type="number" placeholder="Price">
<input id="pqty" type="number" placeholder="Quantity">
<button onclick="addProduct()">Save Product</button>
</div>

<div class="card">
<h3>Customer Details</h3>
<input id="cname" placeholder="Customer Name">
<input id="cphone" placeholder="Phone">
<textarea id="caddress" placeholder="Address"></textarea>
</div>

<div class="card">
<h3>Sale</h3>
<input id="search" placeholder="Search by name or code" oninput="searchProduct()">
<div id="suggestions"></div>

<table id="cartTable">
<tr><th>Name</th><th>Qty</th><th>Total</th></tr>
</table>

<h3 id="grandTotal">Total: 0</h3>

<button onclick="checkoutOnly()">Checkout Only</button>
<button onclick="printAndCheckout()">Print Bill</button>
<button onclick="showAnalytics()">Sales Analytics</button>
</div>

<div class="card" id="analyticsBox" style="display:none">
<h3>Sales Report</h3>
<p id="todaySale"></p>
<p id="weekSale"></p>
<p id="monthSale"></p>
</div>

<!-- RECEIPT AREA -->
<div id="receiptArea" style="display:none;padding:20px;background:white">
<h2 style="text-align:center">Receipt</h2>
<p id="rDate"></p>
<p id="rCustomer"></p>
<table id="receiptTable" style="width:100%;border-collapse:collapse">
</table>
<h3 id="rTotal"></h3>
<p style="text-align:center">Thank You</p>
</div>

<script>
let products=JSON.parse(localStorage.getItem("products"))||[];
let sales=JSON.parse(localStorage.getItem("sales"))||[];
let cart=[];

function save(){
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("sales",JSON.stringify(sales));
}

function normalizeCode(code){
return code.trim().toLowerCase();
}

/* ADD / RESTOCK */
function addProduct(){
let name=pname.value.trim();
let code=normalizeCode(pcode.value);
let price=parseFloat(pprice.value);
let qty=parseInt(pqty.value);

if(!name||!code||isNaN(price)||isNaN(qty))
return alert("Fill correctly");

let existing=products.find(p=>normalizeCode(p.code)===code);

if(existing){
existing.qty+=qty;
existing.price=price;
alert("Product Restocked");
}else{
products.push({name,code,price,qty});
alert("New Product Added");
}

save();
pname.value="";pcode.value="";pprice.value="";pqty.value="";
}

/* SEARCH */
function searchProduct(){
let input=search.value.toLowerCase();
suggestions.innerHTML="";
if(!input)return;

products.filter(p=>
p.name.toLowerCase().includes(input)||
normalizeCode(p.code).includes(input)
).forEach(p=>{
let div=document.createElement("div");
div.className="suggestion-item";
div.innerText=p.name+" | Stock:"+p.qty;
div.onclick=()=>addToCart(p);
suggestions.appendChild(div);
});
}

/* ADD TO CART */
function addToCart(p){
if(p.qty<=0)return alert("Out of stock");

let found=cart.find(c=>normalizeCode(c.code)===normalizeCode(p.code));
if(found)found.qty++;
else cart.push({...p,qty:1});

p.qty--;
save();
renderCart();
search.value="";
suggestions.innerHTML="";
}

/* CART RENDER */
function renderCart(){
cartTable.innerHTML="<tr><th>Name</th><th>Qty</th><th>Total</th></tr>";
let total=0;

cart.forEach(c=>{
let row=cartTable.insertRow();
row.insertCell(0).innerText=c.name;
row.insertCell(1).innerText=c.qty;
row.insertCell(2).innerText=c.price*c.qty;
total+=c.price*c.qty;
});

grandTotal.innerText="Total: "+total;
}

/* CHECKOUT ONLY */
function checkoutOnly(){
if(cart.length==0)return alert("Cart empty");

let total=cart.reduce((sum,c)=>sum+(c.price*c.qty),0);

sales.push({
date:new Date().toISOString(),
amount:total,
customer:cname.value
});

save();
cart=[];
renderCart();
alert("Checkout Complete");
}

/* PRINT + AUTO CHECKOUT */
function printAndCheckout(){
if(cart.length==0)return alert("Cart empty");

let total=cart.reduce((sum,c)=>sum+(c.price*c.qty),0);

sales.push({
date:new Date().toISOString(),
amount:total,
customer:cname.value
});

save();

/* BUILD RECEIPT */
receiptArea.style.display="block";
rDate.innerText="Date: "+new Date().toLocaleString();
rCustomer.innerText="Customer: "+cname.value+" | Phone: "+cphone.value+" | "+caddress.value;

receiptTable.innerHTML="<tr><th>Item</th><th>Qty</th><th>Total</th></tr>";

cart.forEach(c=>{
let row=receiptTable.insertRow();
row.insertCell(0).innerText=c.name;
row.insertCell(1).innerText=c.qty;
row.insertCell(2).innerText=c.price*c.qty;
});

rTotal.innerText="Grand Total: "+total;

/* PRINT */
window.print();

/* RESET AFTER PRINT */
cart=[];
renderCart();
cname.value="";cphone.value="";caddress.value="";
receiptArea.style.display="none";
}

/* ANALYTICS */
function showAnalytics(){
analyticsBox.style.display="block";
let today=0,week=0,month=0;
let now=new Date();

sales.forEach(s=>{
let d=new Date(s.date);
if(d.toDateString()==now.toDateString())today+=s.amount;
if((now-d)/(1000*60*60*24)<=7)week+=s.amount;
if(d.getMonth()==now.getMonth()&&d.getFullYear()==now.getFullYear())month+=s.amount;
});

todaySale.innerText="Today Sale: "+today;
weekSale.innerText="This Week Sale: "+week;
monthSale.innerText="This Month Sale: "+month;
}
</script>

</body>
</html>
